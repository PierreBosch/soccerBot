FROM node:22-alpine

WORKDIR /usr/src/app

# Instalar json-server globalmente
RUN npm install -g json-server@1.0.0-beta.1

# Copiar arquivos necessários
COPY db.json ./
COPY init-db.sh ./

# Dar permissão de execução ao script
RUN chmod +x init-db.sh

EXPOSE 3001

# Executar script de inicialização e depois o json-server
# --host 0.0.0.0 permite acesso de outros containers
CMD ["sh", "-c", "./init-db.sh && json-server db.json --host 0.0.0.0 --port 3001"]

